{% extends 'boog_base.html' %}
{% block styles %}
<style type="text/css">

    div {
        /*border: thin black dashed;*/
    }

    div.task_editbar {
        clear: both;
        text-align: right;
        margin-right: 1em;
    }

    div.edit_task, .view_task {
        width: 600px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 2em;
        border: thin black solid;
        border-radius: 3px;
        background-color: #eee;
    }

    div.task_side {
        float: left;
        border-right: thin #ccc solid;
        font-size: 0.75em;
        margin-bottom: 0px;
        position: relative;
        width: 130px;
        height: auto;
        top: 0px;
        bottom: 0px;
        left: 0px;
    }

    div.task_main {
        width: 456px;
        float: right;
    }

    .task_side div.task_id {
        height: 130px;
        border-bottom: thin #ccc solid;
        font-size: 7em;
        text-align: center;
    }

    .task_side div.task_id div {
        font-size: 0.2em;
    }

    .task_side div.task_id a {
        text-decoration: none;
    }

    div.task_main .project, .type, .status, .assigned_to {
        display: block;
        float: left;
    }

    input, select, textarea {
        background-color: #eef;
        color: #005;
    }

    .task_main .title {
        clear: both;
        display: block;
        width: 100%;
    }

    .task_main .title #title {
        width:  95%;
    }

    .task_main .comment {
        display: block;
        bottom: 0px;
        margin-right: 1em;
    }

    .task_main .comment #comment {
        width: 100%;
        height: 140px;
    }

    .task_main .comments {
        display: block;
        clear: both;
    }

    .task_main .comments .comment {
        border: 2px #ccc solid;
        border-radius: 3px;
        padding: 0.5em;
        margin-top: 0.2em;
        max-height: 20em;
        background-color: #eee;
    }

    .task_main .comments .comment .comment_text {
        max-height: 20em;
        border-bottom: thin #ccc solid;
        white-space: pre;
        overflow: auto;
    }

    .task_main .comments .author {
        display: inline;
        background-color: #eee;
    }
</style>
{% endblock %}

{% block content %}

{% if mode == 'edit' %}
<div class="edit_task">
    <div>
    {% if task %}
    <form action="{{ url_for('.tasks', id=task.id) }}" method="POST" id='task_form'>
    {% else %}
    <form action="{{ url_for('.tasks') }}" method="POST" id='task_form'>
    {% endif %}
        {% include 'forms/task.html' %}
        <div style='text-align: right; margin-right: 1em; clear: both;'>
            <input type="submit" value="OK" onclick="(function(){ submitting=true; })()"/>
        </div>
    </form>
</div>

<script type="text/javascript">
    var submitting = false;
    function has_edits(){
        var form = document.getElementById('task_form');
        if (form.project.value == "{{ form.project.data }}"
                && form.type.value == "{{ form.type.data }}"
                && form.status.value == "{{ form.status.data }}"
                && form.assigned_to.value == "{{ form.assigned_to.data }}"
                && form.title.value == "{{ form.title.data }}"
                && form.comment.value == ""){
            return false;
        }
        return true;
    }

    function really_close(){
        if (!submitting && has_edits()){
            return "You have unsaved edits - discard edits?";
        }
    }

    document.getElementById('project').focus();
    window.onbeforeunload = really_close;
</script>
{% else %}
    {% include 'views/task.html' %}
{% endif %}

{% endblock %}
